<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>chihaya: Delayed operations in HDF5</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">chihaya
   </div>
   <div id="projectbrief">Validating delayed array operations in HDF5</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Delayed operations in HDF5 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__github_workspace_README"></a> </p><h1>Introduction</h1>
<p >This repository contains a specification for delayed array operations stored in a HDF5 file. The concept of delayed operations is taken from Bioconductor's <a href="https://bioconductor.org/packages/DelayedArray"><b>DelayedArray</b></a> package, where any operations on a <code>DelayedArray</code> are cached in memory and evaluated on an as-needed basis. Our aim is to save these operations to file in a well-defined, cross-language format; this avoids the need to compute and store the results of such operations, which may be prohibitively expensive.</p>
<p >Several use cases benefit from the serialization of delayed operations:</p>
<ul>
<li>We have an immutable array dataset stored in a database. Rather than making a copy for manipulation, we can hold a reference to the original and save the operations (slicing, arithmetic, etc.). This avoids duplication of large datasets.</li>
<li>We have a dataset that can be represented in a small type, e.g., <code>uint8_t</code>s. We apply a transformation that promotes the type, e.g., log-transformation to <code>float</code>s or <code>double</code>s. By saving the delayed operation, we can maintain our compact representation to reduce the file size.</li>
<li>We have a sparse dataset that is subjected to sparsity-breaking operation, e.g., centering. Rather than saving the dense matrix, we keep the efficient sparse representation and save the delayed operation.</li>
</ul>
<h1>Specification</h1>
<p >In the <b>chihaya</b> specification, we store a "delayed object" as a HDF5 group in the file. Delayed operations are represented as further nested groups, terminating in an array containing the original data (or a reference to it). The type of delayed operation/array is specified in the group's attributes. By recursively inspecting the contents of each HDF5 group, applications can reconstitute the original delayed object in the framework of choice.</p>
<p >The <b>chihaya</b> specification currently supports a range of delayed operations including subsetting, combining, transposition, matrix products, and an assortment of unary and binary operations. It also supports dense arrays, sparse matrices, constant arrays and custom arrays. More details about the on-disk representation of each operation can be found in the specifications:</p>
<ul>
<li><a href="https://github.com/ArtifactDB/chihaya/tree/gh-pages/docs/specifications/1.1/_general.md">1.1</a></li>
<li><a href="https://github.com/ArtifactDB/chihaya/tree/gh-pages/docs/specifications/1.0/_general.md">1.0</a></li>
<li><a href="https://github.com/ArtifactDB/chihaya/tree/gh-pages/docs/specifications/0.99/_general.md">0.99</a></li>
</ul>
<h1>Using the validation library</h1>
<p >In C++, a delayed object in a file can be validated by calling the <a href="https://artifactdb.github.io/chihaya/validate_8hpp.html"><code>validate</code></a> function:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="chihaya_8hpp.html">chihaya/chihaya.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="namespacechihaya.html#ad6581f0bab127afd92cecfc35b1a0f64">chihaya::validate</a>(<span class="stringliteral">&quot;path_to_file.h5&quot;</span>, <span class="stringliteral">&quot;delayed/object/name&quot;</span>);</div>
<div class="ttc" id="achihaya_8hpp_html"><div class="ttname"><a href="chihaya_8hpp.html">chihaya.hpp</a></div><div class="ttdoc">Umbrella header for all chihaya code.</div></div>
<div class="ttc" id="anamespacechihaya_html_ad6581f0bab127afd92cecfc35b1a0f64"><div class="ttname"><a href="namespacechihaya.html#ad6581f0bab127afd92cecfc35b1a0f64">chihaya::validate</a></div><div class="ttdeci">ArrayDetails validate(const H5::Group &amp;handle, const ritsuko::Version &amp;version)</div><div class="ttdef"><b>Definition:</b> validate.hpp:106</div></div>
</div><!-- fragment --><p >In R, <code>DelayedArray</code> objects (from the <a href="https://bioconductor.org/packages/DelayedArray"><b>DelayedArray</b></a> package) can be saved to a <b>chihaya</b>-compliant HDF5 file using the <a href="https://github.com/AritfactDB/chihaya-R">our R package</a>. The same package also reconstitutes a <code>DelayedArray</code> from the file.</p>
<div class="fragment"><div class="line">library(DelayedArray)</div>
<div class="line">X &lt;- DelayedArray(matrix(runif(100), 100, 20)) </div>
<div class="line">X &lt;- log(t(t(X) / runif(ncol(X))) + 1) </div>
<div class="line"> </div>
<div class="line">library(chihaya)</div>
<div class="line">tmp &lt;- tempfile(fileext=&quot;.h5&quot;)</div>
<div class="line">saveDelayed(X, tmp)</div>
<div class="line">Y &lt;- loadDelayed(tmp)</div>
</div><!-- fragment --><h1>Building projects</h1>
<h2>CMake with <code>FetchContent</code></h2>
<p >If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  chihaya</div>
<div class="line">  GIT_REPOSITORY https://github.com/ArtifactDB/chihaya</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(chihaya)</div>
</div><!-- fragment --><p >Then you can link to <b>chihaya</b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe chihaya)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE chihaya)</div>
</div><!-- fragment --><h2>CMake with <code>find_package()</code></h2>
<p >You can install the library by cloning a suitable version of this repository and running the following commands:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DTATAMI_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p >Then you can use <code>find_package()</code> as usual:</p>
<div class="fragment"><div class="line">find_package(artifactdb_chihaya CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE artifactdb::chihaya)</div>
</div><!-- fragment --><h2>Manual</h2>
<p >If you're not using CMake, the simple approach is to just copy the files the <code>include/</code> subdirectory - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. You will also need to link to the HDF5 library, usually from a system installation (1.10 or higher).</p>
<h1>Further comments</h1>
<p >Web applications can read delayed matrices into memory using the <a href="https://npmjs.com/package/chihaya"><b>chihaya</b></a> Javascript package.</p>
<p >At some point, we may also add <a href="https://github.com/tatami-inc/tatami"><b>tatami</b></a> bindings to load the delayed operations into memory. This would enable C++ applications to natively read from the HDF5 files that comply with <b>chihaya</b>'s specification.</p>
<p >The library is provisionally named after <a href="https://myanimelist.net/character/10369/Chihaya_Kisaragi">Chihaya Kisaragi</a>, one of my favorite characters.</p>
<p ><img src="https://raw.githubusercontent.com/LTLA/acceptable-anime-gifs/master/registry/10278_Idolmaster/0001.gif" alt="Chihaya GIF" class="inline"/> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
