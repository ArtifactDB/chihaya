```{r, results="asis", echo=FALSE}
knitr::opts_chunk$set(error=FALSE)
if (!exists(".version")) {
    .version <- package_version("1.0")
}
```

```{r, results="asis", echo=FALSE}
cat("# General concepts (", as.character(.version), ")", sep="")
```

## Overview 

In the **chihaya** specification, we store a "delayed object" as a HDF5 group in the file.
Delayed operations are represented as further nested groups, terminating in an array containing the original data (or a reference to it).
The type of delayed operation/array is specified in the group's attributes.
By recursively inspecting the **chihaya** HDF5 file, readers can reconstitute the entire delayed object by re-applying all of the operations.

## Operation types

## Array types

## Value types

Delayed objects can have four value types - boolean, integer, float and string.
Adding a delayed operation to an object may cause it to change its type.

Booleans are promoted to integers via the usual rules, i.e., true values are 1 and false values are 0.

Integers are promoted to floats in the expected manner.
As a general rule, the framework that reads **chihaya** files should use 32-bit signed integers and 64-bit floats.
Thus, any promotion of integers to floats will be lossless.

In some cases, integers or floats must be treated as booleans.
This is done in the usual way, i.e., non-zero values are truthy and zero values are falsey.

## Lists

Some specifications will include a "list", which is represented as a HDF5 group with the following attributes:

```{r}
if (.version < package_version("1.1")) {
    cat('- `delayed_type`, a scalar string dataset with a datatype that can be represented by a UTF-8 encoded string.
  This should contain the value `"list"`.
- `delayed_length`, a scalar integer dataset specifying the list length.
  Any integer datatype may be used here.')
    len_txt <- "delayed_length"
} else {
  cat("- `length`, a scalar integer dataset with a datatype that can fit into a 64-bit unsigned integer.
  This should contain the length of the list.")
    len_txt <- "length"
}
len_txt <- paste0("`", len_txt, "`")
```

Children of this group represent the list elements and are named by their positional index.
List elements may be absent, e.g., a group with `r len_txt` set to 3 and the children `0` and `2` represents a list that is missing an element at index 1.
The intepretation of the absence of an element is context-dependent.
